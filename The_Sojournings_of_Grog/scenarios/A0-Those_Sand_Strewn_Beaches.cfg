#textdomain wesnoth-The_Sojournings_of_Grog

#
# MAP
#
# Merfolk start in deep water to the NW.
# To the NE is a dubious district containing a big nasty and (possibly) an easter-egg.
# SW is a shallow beach (guarded by mudcrawlers?) with a large quantity of shallow water.
# A Naga castle guards the SE deep water fjord with the deep water running directly up to the shore.
# The shore is guarded by a few humans in the villages.
# The destination signpost lies on the southern map edge.
#
# STRATEGY
#
# You have a ship (containing idle Grog, elves etc) surrounded by a bodyguard of merfolk.
# The ship can't leave the deep water.
# The nagas are programmed to prefer shallow water and swamps so they tend to rake the shores.
# There is a temple(empty) to the NE otherwise you dont go there.
# The goal is to land Grog and bring him to the signpost possibly knocking out the Nagas (for a bonus).
# You either bring him straight down to the beach which requires him running through the shallow water attacked by nagas.
# Or you take him to the SE and land him directly on the shore.
# If you take the beach route there are mudcrawlers and tentacles waiting for you.
# If you take the pier route there are bandits instead.
#
# BONUSES
#
# Gold when you beat the nagas.
# Mudcrawler (with AMLAs?) when you beat the humans.
# ring of camouflage when you beat the mudcrawlers.
#
# VARIABLES (L = local to this scenario, G = global to the campaign)
#
# beach_landing (L) = if they decided to land on the beach.
# pier_landing (L) = if they decided to land on the pier.
# ship_unloaded (L) = have the troops left the ship.
# temple_visited (L) = has the temple been visited.
# + more
#

# wmllint: recognize Grog
# wmllint: recognize ship

[scenario]
    id=A0

    name =_"Those Sand Strewn Beaches"
    map_data="{~add-ons/The_Sojournings_of_Grog/maps/A0-Those_Sand_Strewn_Beaches.map}"

    victory_when_enemies_defeated=no

    next_scenario=A1
    {TURNS 20 19 18}

    {TWO_SUNS_DEFAULT_SCHEDULE}

#ifhave ~add-ons/UMC_Music/_main.cfg
    # wmlscope: start ignoring
    {INTRO_AND_SCENARIO_MUSIC "battle-epic.ogg" "wanderer.ogg"}
    {EXTRA_SCENARIO_MUSIC "traveling_minstrels.ogg"}
    {EXTRA_SCENARIO_MUSIC "nunc_dimittis.ogg"}
    {EXTRA_SCENARIO_MUSIC "a3deap_GoForTheWorldAgain.ogg"}
    # wmlscope: stop ignoring
#else
    {INTRO_AND_SCENARIO_MUSIC "battle-epic.ogg" "wanderer.ogg"}
    {EXTRA_SCENARIO_MUSIC "traveling_minstrels.ogg"}
    {EXTRA_SCENARIO_MUSIC "nunc_dimittis.ogg"}
#endif

    [story]
        [part]
            story= _"Grog and his companions set sail under the expert guidance of the Merfolk. Their luck held and they reached the mainland within a few days and without incident."
            background=story/Guardtower.jpg
        [/part]
        [part]
            story= _"After Yechnagoth's empire collapsed the entire region feel into anarchy; tribal leaders and viscous brigands claimed the land and instilled their own reigns of terror. Peaceful communities were driven into the most desolate lands. The Nagas had infested the coastal waters and swamps, disrupting trade and pillaging the villages built around them. The deeper, cleaner seas were populated by the Mermen who strove to gain control of the vital waterways."
            background=story/Guardtower.jpg
        [/part]
        [part]
            story= _"The arrival of an Elven ship guarded by Mermen was considered an invasion by the Nagas who seek to control all traffic around the mainland..."
            background=story/Guardtower.jpg
        [/part]
    [/story]

    [side]
        side=1
        controller=human

        team_name=goodies
        user_team_name=_"Goodies"

        {GOLD 0 0 0}
        {INCOME 0 0 0}

        {GROG}
        type="Grog Hero"

        {TROLL_FLAG}
    [/side]

    [side]
        type=Naga Warrior
        id=nagaboss
        name="Abraxas"

        canrecruit=yes
#ifdef EASY
        recruit=Naga Fighter,Naga Hunter
#else
        recruit=Naga Fighter,Naga Warrior,Naga Hunter
#endif
        side=2
        team_name=Nagas
        user_team_name=_"Nagas"
        #was outside ai tag. Thanks wmllint. E_H.
        {GOLD 60 70 80}
        income=6

        [ai]
            recruitment_pattern=fighter,fighter,archer
            #insane settings to avoid units stuck. E_H.
            aggression=1.0
            caution=0.0
            grouping=offensive
            [avoid]
                #avoid: deep water,grass, village, all desert terrains.
                terrain=Wo,Gs,Gg^Vh,Ds,Dd,Dd^Vdt,Dd^Dc,Dd^Vda,Dd^Do,Dd^Dr
            [/avoid]
            #[avoid]
            #	[filter_location]
            #		terrain=Wo
            #	[/filter_location]
            #[/avoid]
            [target]
                side=1
                value=5
            [/target]
            [target]
                side=3,4
                value=1
            [/target]
            [avoid]
                x=22,27,30,34
                y=21,23,25,26
                value=5
            [/avoid]
        [/ai]

        {FLAG_VARIANT drake}

        {GENERIC_UNIT_WITH_ID 1 (Naga Warrior) 9 15 naga1} {GUARDIAN}
        {GENERIC_UNIT_WITH_ID 1 (Naga Hunter) 17 15 naga2} {GUARDIAN}
        {GENERIC_UNIT 1 (Naga Fighter) 12 17} {GUARDIAN}
        {GENERIC_UNIT 1 (Naga Fighter) 3 15} {GUARDIAN}
        {GENERIC_UNIT 1 (Naga Warrior) 13 15} {GUARDIAN}
        {GENERIC_UNIT 1 (Naga Fighter) 6 16} {GUARDIAN}
    [/side]

    [side]
        no_leader=yes
        side=3
        gold=0
        income=0
        controller=ai
        shroud=no
        fog=no
        team_name=monsters
        user_team_name=_"Monsters"
        canrecruit=no

        [ai]
            [target]
                side=1
                value=5
            [/target]
            [target]
                side=2,4
                value=1
            [/target]
        [/ai]
    [/side]

    [side]
        no_leader=yes
        side=4
        gold=0
        income=0
        controller=ai
        shroud=no
        fog=no
        team_name=villagers
        user_team_name=_"Villagers"

        [ai]
            [target]
                side=1
                value=5
            [/target]
            [target]
                side=2,3
                value=1
            [/target]
        [/ai]
    [/side]

    # no more than two naga hunters on the field, as you asked.
    # For my information, the number of units is the last value in the macro. E_H.
    {LIMIT_CONTEMPORANEOUS_RECRUITS 2 (Naga Hunter) 2}
#ifndef EASY
    # 2 naga warriors are already placed at start. E_H.
    {LIMIT_CONTEMPORANEOUS_RECRUITS 2 (Naga Warrior) 3}
#endif

    [event]
        name=prestart

        #left over from part 1
        [unhide_unit]
            #	id=Grog
            side=1
        [/unhide_unit]

        [store_unit]
            [filter]
                id=Grog
            [/filter]
            variable=stored_Grog
            kill=yes
        [/store_unit]

        [set_variable]
            name=beach_landing
            value=no
        [/set_variable]

        [set_variable]
            name=pier_landing
            value=no
        [/set_variable]

        [set_variable]
            name=ship_unloaded
            value=no
        [/set_variable]

        [set_variable]
            name=temple_visited
            value=no
        [/set_variable]

        # for use by the "mudcrawler-in-a-bottle" creation code. E_H.
        [set_variable]
            name=bottle_created
            value=no
        [/set_variable]

        [set_variable]
            name=bottle_x
            value=0
        [/set_variable]

        [set_variable]
            name=bottle_y
            value=0
        [/set_variable]

        [capture_village]
            x=4 ,2 ,14,21,31,34,34,36
            y=11,16,16,18,14,15,13,19
            side=2
        [/capture_village]

        [item]
            image=scenery/temple1.png
            x,y=30,4
        [/item]

        [objectives]
            side=1
            [objective]
                description= _ "Grog must reach the signpost"
                condition=win
            [/objective]
            [objective]
                # Pango is the solution. E_H.
                description= _ "<span foreground='white'>Kill Naga leader (Bonus)</span>"
                condition=win
            [/objective]
            [objective]
                description= _ "Death of Grog"
                condition=lose
            [/objective]
            #yes, if Esanoo dies you lose because we need him for the C part. E_H.
            [objective]
                description= _ "Death of Esanoo"
                condition=lose
            [/objective]
            [objective]
                description= _ "The ship is sunk before it lands its troops."
                condition=lose
            [/objective]
            [objective]
                description= _ "Time runs out"
                condition=lose
            [/objective]
            [gold_carryover]
                bonus=yes
                carryover_percentage=40
            [/gold_carryover]
        [/objectives]
    [/event]

    [event]
        name=start

        [delay]
            time=1000
        [/delay]

        [move_unit_fake]
            type=Ship
            side=1
            x=5,5,6,6,7,8,9,10,11,12
            y=1,2,2,3,4,4,5,5,6,6
        [/move_unit_fake]

        {GENERIC_UNIT_WITH_ID 1 (Ship) 12 6 ship}

        [modify_unit]
            [filter]
                id=Grog
            [/filter]
            canrecruit=no
        [/modify_unit]

        [modify_unit]
            [filter]
                id=ship
            [/filter]
            canrecruit=yes
        [/modify_unit]

        [delay]
            time=100
        [/delay]

        [unit]
            type=Merman Entangler
            id=Esanoo
            name= _ "Esanoo"
            profile=portraits/esanoo.png
            overlays=misc/hero-icon.png
            x=11
            y=5
            side=1
            unrenamable=yes
            [modifications]
                {TRAIT_STRONG}
                {TRAIT_RESILIENT}
                {TRAIT_LOYAL}
            [/modifications]
        [/unit]

#ifdef EASY
        {GENERIC_UNIT 1 (Mermaid Priestess) 9 6}
        {GENERIC_UNIT 1 (Merman Hunter) 14 5}
        {GENERIC_UNIT 1 (Merman Spearman) 10 8}
        {GENERIC_UNIT 1 (Merman Fighter) 12 7}
        {GENERIC_UNIT 1 (Merman Warrior) 14 7}
#endif
#ifdef NORMAL
        {GENERIC_UNIT 1 (Mermaid Priestess) 9 6}
        {GENERIC_UNIT 1 (Merman Hunter) 14 5}
        {GENERIC_UNIT 1 (Merman Hunter) 10 8}
        {GENERIC_UNIT 1 (Merman Fighter) 12 7}
        {GENERIC_UNIT 1 (Merman Fighter) 14 7}
#endif
#ifdef HARD
        {GENERIC_UNIT 1 (Mermaid Initiate) 9 6}
        {GENERIC_UNIT 1 (Merman Hunter) 14 5}
        {GENERIC_UNIT 1 (Merman Hunter) 10 8}
        {GENERIC_UNIT 1 (Merman Fighter) 12 7}
        {GENERIC_UNIT 1 (Merman Fighter) 14 7}
#endif

        [message]
            speaker=naga1
            message= _ "Hsss. Who goess there." # wmllint: no spellcheck
        [/message]

        [message]
            speaker=naga2
            message= _ "Itss those stinkingsss elvesss and the fishesss." # wmllint: no spellcheck
        [/message]

        [message]
            speaker=ship
            caption= _ "Grog"
            # wmllint: local spelling strai
            message= _ "Grog and little Elves wan' to land..."
            image=portraits/grog.png
        [/message]

        [message]
            speaker=naga1
            message= _ "Soundss the alarmssses." # wmllint: no spellcheck
            sound=horn-signals/horn-4.ogg,horn-signals/horn-6.ogg
        [/message]

        [message]
            speaker=Esanoo
            message= _ "Grog, Nagas only understand diplomacy when it is accompanied by the point of a spear."
        [/message]

        {HIGHLIGHT_IMAGE 18 27 "scenery/signpost.png" ()}
    [/event]

    [event]
        name=moveto
        [filter]
            id=ship
        [/filter]

        #COMMENT could this be changed to when you first move the ship.
        # DONE. E_H.

        [message]
            speaker=Esanoo
            # wmllint: local spelling draught
            message= _ "This ship has a large draught. We will not be able to sail it into the shallows."
        [/message]

        [message]
            speaker=narrator
            message=_"The ship is consigned to deep water. To land your troops bring it to the edge of the shallows and your troops will be disembarked automatically. Alternatively land your troops near the piers to the south-east."
            image=wesnoth-icon.png
        [/message]
    [/event]

    #
    # Naga Attack
    #
    [event]
        name=attack

        [filter]
            race=naga
        [/filter]

        [filter_second]
            side=1
        [/filter_second]

        [fire_event]
            name=naga_attack
            [primary_unit]
                x,y=$unit.x,$unit.y
            [/primary_unit]
        [/fire_event]
    [/event]

    [event]
        name=attack

        [filter]
            side=1
        [/filter]

        [filter_second]
            race=naga
        [/filter_second]

        [fire_event]
            name=naga_attack
            [primary_unit]
                x,y=$second_unit.x,$second_unit.y
            [/primary_unit]
        [/fire_event]
    [/event]

    [event]
        name=naga_attack

        [message]
            speaker=unit
            message= _ "Hsss! Thissss issss Naga sseeaaasss. Keep outssss." # wmllint: no spellcheck
        [/message]
    [/event]

    #
    # Disembarkation
    #
    [event]
        name=moveto

        [filter]
            id=ship
            x=1 ,2 ,3 ,4 ,5 ,6 ,6 ,6 ,7 ,8 ,9 ,10,11,12,13,14,15,16,17,18,19,20,21,21,21,22,22,23,24,25,26,27,28,29,30,31,32,33,33,32,31,30,29,28,27,26,25,24,24,24,25,26,27,28,28,28,28,28,27,26,25,25,24,24,24,25,26,27
            y=10,9 ,9 ,8 ,9 ,9 ,10,11,12,12,12,11,12,12,13,12,12,11,12,12,12,12,13,14,15,15,16,17,17,18,18,18,18,19,19,20,20,20,19,18,18,17,17,16,16,15,15,14,13,12,12,11,11,11,10,9 ,8 ,7 ,7 ,6 ,6 ,5 ,4 ,3 ,2 ,2 ,1 ,1
        [/filter]

        #CHANGE cut unnecessary verbage
        #[message]
        #	speaker=ship
        #	caption= _ "Grog"
        #	message= _ "Grog says land here."
        #	image=portraits/grog.png
        #[/message]

        [unstore_unit]
            variable=stored_Grog
            x,y=$unit.x,$unit.y
            find_vacant=yes
            check_passability=yes
        [/unstore_unit]

        {CLEAR_VARIABLE stored_Grog}

        [modify_unit]
            [filter]
                id=Grog
            [/filter]
            canrecruit=yes
        [/modify_unit]

        [modify_unit]
            [filter]
                id=ship
            [/filter]
            canrecruit=no
        [/modify_unit]

        # as from 1.9.5+svn, recall checks for terrain passabilty by default.
        # with this, we no longer need the old RECALL_NEAR_SHIP macro. E_H.
        [recall]
            id=Arcamenel
            x,y=$unit.x,$unit.y
        [/recall]
        [recall]
            id=Bedet
            x,y=$unit.x,$unit.y
        [/recall]
        [recall]
            id=Calaelen
            x,y=$unit.x,$unit.y
        [/recall]
        [recall]
            id=Defu
            x,y=$unit.x,$unit.y
        [/recall]
        [recall]
            id=Falassion
            x,y=$unit.x,$unit.y
        [/recall]
        [recall]
            id=Heka
            x,y=$unit.x,$unit.y
        [/recall]

        [set_variable]
            name=ship_unloaded
            value=yes
        [/set_variable]

        [message]
            speaker=narrator
            message= _ "A living legend of the trek to defeat Yechnagoth at Zocthanol Isle, Grog has traveled so much of the known and unknown world he is now able to 'inspire' other units to fight better in combat."
            image=wesnoth-icon.png
        [/message]
    [/event]

    #
    # Tentacles
    #
    #[event]
    #	name=moveto
    #
    #	[filter]
    #		side=1
    #		[filter_location]
    #			x=1-15
    #			y=14-18
    #		[/filter_location]
    #	[/filter]
    #
    #	[message]
    #		speaker=nagaboss
    #		#NB: I dont like this string. Eros
    #		message=_"Theyss is too close tos the beach. Awake the tentacless." # wmllint: no spellcheck
    #	[/message]
    #	#this take the turn number and increases it by 1...
    #	[set_variable]
    #		name=tentacle_trigger
    #		value=$turn_number
    #	[/set_variable]
    #	{VARIABLE_OP tentacle_trigger add 1}
    #[/event]

    #[event]
    #	#...to awake the tentacles in the very next turn. E_H.
    #	name=new turn
    #	first_time_only=no
    #	[if]
    #		[variable]
    #			name=turn_number
    #			equals=$tentacle_trigger
    #		[/variable]
    #		[then]
    #			{GENERIC_UNIT 2 (Tentacle of the Deep) 2 17}
    #			{GENERIC_UNIT 2 (Tentacle of the Deep) 6 17}
    #			{GENERIC_UNIT 2 (Tentacle of the Deep) 9 18}
    #			{GENERIC_UNIT 2 (Tentacle of the Deep) 12 17}
    #			{GENERIC_UNIT 2 (Tentacle of the Deep) 15 18}
    #			{CLEAR_VARIABLE tentacle_trigger}
    #		[/then]
    #	[/if]
    #COMMENT have a tentacle say "Splash." and esanoo say "Protect the ship at all costs" if they havent landed yet.
    #[/event]
    #
    # Beach Landing
    #
    [event]
        name=moveto

        [filter]
            side=1

            #merged two filter_location. E_H.
            [filter_location]
                terrain=Ds,Dd,Dd^*
            [/filter_location]

            [not]
                race=merman
            [/not]
        [/filter]

        [if]
            [variable]
                name=pier_landing
                equals=no
            [/variable]

            [then]
                [set_variable]
                    name=beach_landing
                    value=yes
                [/set_variable]

#ifdef EASY
                {GENERIC_UNIT 3 Mudcrawler 4 20}
                {GENERIC_UNIT 3 Mudcrawler 13 24}
#else
                {GENERIC_UNIT 3 (Giant Mudcrawler) 4 20}
                {GENERIC_UNIT 3 (Giant Mudcrawler) 13 24}
#endif
#ifndef HARD
                {GENERIC_UNIT 3 Mudcrawler 9 21}
                {GENERIC_UNIT 3 Mudcrawler 16 19}
#else
                {GENERIC_UNIT 3 (Giant Mudcrawler) 9 21}
                {GENERIC_UNIT 3 (Giant Mudcrawler) 16 19}
#endif
                {GENERIC_UNIT_WITH_ID 3 (Giant Mudcrawler) 12 21 mudcrawler}
                {GENERIC_UNIT 3 (Giant Mudcrawler) 10 25}
                {GENERIC_UNIT 3 (Giant Mudcrawler) 8 23}

                [message]
                    speaker=mudcrawler
                    #please replace this random string (Eros)
                    #To make it "speak", I copied the first "word" from A Rough Life,
                    #the next three from Ooze Mini Campaign and the last four from Brotherhood of Light. It's enough? E_H.
                    message= _ "Mrrrmm! Gurgle! Splorch! Glargle! Shholpoupl! Shhlop! Shhlorp! Shhlorp-Gup!" # wmllint: no spellcheck
                [/message]

                {ELF_ROLE_MALE elf1}

                [message]
                    role=elf1
                    message= _"What, in the name of Eloh, is that?"
                [/message]

                {ELF_ROLE_FEMALE elf2}

                [message]
                    role=elf2
                    message= _"Lumps of animated mud? Whatever they are, strike them down!"
                [/message]
            [/then]
            [else]
                # on easy: 3 scorpions on medium: 4 on hard: 5 E_H.
                {GENERIC_UNIT 3 (Giant Scorpion) 15 25}
                {GENERIC_UNIT 3 (Giant Scorpion) 18 24}
                {GENERIC_UNIT 3 (Giant Scorpion) 22 26}
#ifdef NORMAL
                {GENERIC_UNIT 3 (Giant Scorpion) 13 22}
#endif
#ifdef HARD
                {GENERIC_UNIT 3 (Giant Scorpion) 13 22}
                {GENERIC_UNIT 3 (Giant Scorpion) 10 24}
#endif

                {ELF_ROLE_MALE elf1}

                [scroll_to]
                    x,y=10,23
                [/scroll_to]
                [delay]
                    time=500
                [/delay]
                [message]
                    role=elf1
                    message= _ "Scorpions! Does any desert not have them?"
                [/message]
            [/else]
        [/if]
    [/event]

    #
    # Nested Event: All mudcrawlers killed
    # No need to make it nested: if any other unit dies, the event won't be fired anyway... E_H.
    [event]
        name=die

        #filter added, otherwise I suspect that this event will fire more than once... E_H.
        [filter]
            type=Mudcrawler,Giant Mudcrawler
        [/filter]

        [filter_condition]
            [not]
                # why two have_unit tags? Simplified. E_H.
                [have_unit]
                    type=Mudcrawler,Giant Mudcrawler
                [/have_unit]
            [/not]
        [/filter_condition]

        [if]
            [variable]
                name=second_unit.id
                equals=Grog
            [/variable]
            [then]
                # Note: I decided that Grog calls all Mudcrawlers "mudpies". E_H.
                # wmllint: local spelling mudpie mudpies
                [message]
                    speaker=Grog
                    message= _ "Grog says mudpies gone. Let's go."
                [/message]
            [/then]
            [else]
                [message]
                    speaker=second_unit
                    message= _"Phew, They are finally exterminated."
                [/message]

                [message]
                    speaker=Grog
                    message= _"Let's go."
                [/message]
            [/else]
        [/if]
        [set_variable]
            name=got_ring_camouflage
            value=no
        [/set_variable]
        {RING_CAMOUFLAGE $x1 $y1}

        [redraw]
        [/redraw]

        [if]
            [variable]
                name=second_unit.id
                equals=Grog
            [/variable]
            [then]
                [message]
                    speaker=Grog
                    message= _ "Grog says mudpie dropped ring. Someone want ring?"
                [/message]
            [/then]
            [else]
                [message]
                    speaker=second_unit
                    message= _"Ahh, what's this? It looks like a ring. Must be whatever that creature last had for dinner was wearing it. Someone might want to check it out."
                [/message]
            [/else]
        [/if]
    [/event]

    #
    # Pier Landing
    #
    [event]
        name=moveto

        [filter]
            side=1

            # why two filter_location tags? Simplified again.
            # Removed also the first and tag, because filter_location can be part of filter tag. E_H.
            [filter_location]
                terrain=Gs,Gg^*
            [/filter_location]

            [not]
                race=merman
            [/not]
        [/filter]

        [filter_condition]
            [variable]
                name=beach_landing
                equals=no
            [/variable]
        [/filter_condition]

        [set_variable]
            name=pier_landing
            value=yes
        [/set_variable]
    [/event]

    #
    # Nested Event: Capture a bandit village
    # Let's try without having it nested.
    # Added a variable check, to compensate the missing nested event. E_H.
    [event]
        name=moveto

        [filter]
            side=1
            x=22,27,30,34
            y=21,23,25,26
        [/filter]

        [filter_condition]
            [variable]
                name=pier_landing
                equals=yes
            [/variable]
        [/filter_condition]

        # first thing: villagers are on side 4
        [unit]
            side=4
#ifdef HARD
            type=Rogue
#else
            type=Thief
#endif
            x=$x1
            y=$y1
            id=human
            #even if she can't recruit nothing, without this she can't capture villages.
            canrecruit=yes
            generate_name=yes
            random_traits=yes
            gender=female
            upkeep=full
        [/unit]

        # second thing: villagers pop out here, more believable as a revolt.
        # and third: side 4!
        {GENERIC_UNIT 4 (Poacher) 22 21}
        {GENERIC_UNIT 4 (Footpad) 27 23}
        {GENERIC_UNIT 4 (Thug) 30 25}
        {GENERIC_UNIT 4 (Poacher) 34 26}
        # two ruffians, to compensate the mainline weakening of Footpads
#ifdef EASY
        {GENERIC_UNIT 4 (Ruffian) 28 21}
        {GENERIC_UNIT 4 (Ruffian) 32 23}
#endif
#ifdef NORMAL
        {GENERIC_UNIT 4 (Footpad) 28 21}
        {GENERIC_UNIT 4 (Footpad) 32 23}
#endif
#ifdef HARD
        {GENERIC_UNIT 4 (Footpad) 28 21}
        {GENERIC_UNIT 4 (Thug) 32 23}
#endif

        # fourth: she can recruit, and can take villages as well.
        [capture_village]
            x=22,27,30,34
            y=21,23,25,26
            side=4
        [/capture_village]

        [message]
            speaker=human
            message= _"Get out of here you brigands! We told you we'd stick it to you if you ever came back."
        [/message]

        [if]
            [variable]
                name=unit.id
                equals=Grog
            [/variable]
            [then]
                [message]
                    speaker=Grog
                    message= _ "Grog and little Elves no brigands, Grog only passing here."
                [/message]
            [/then]
            [else]
                [message]
                    speaker=unit
                    message= _"We are no brigands, we are travelers and are just passing through."
                [/message]
            [/else]
        [/if]

        [message]
            speaker=human
            # wmllint: local spelling Pah
            message= _"Pah... Elves! Just as bad as those brigands; pillage and burn! We'll see you off."
        [/message]
    [/event]

    #
    # Nested Event: All villagers killed
    # again, no need to make it nested: there aren't any other humans around except bandits... E_H.
    [event]
        name=die

        [filter]
            race=human
        [/filter]

        [filter_condition]
            [not]
                [have_unit]
                    race=human
                [/have_unit]
            [/not]
        [/filter_condition]

        [if]
            [variable]
                name=second_unit.id
                equals=Grog
            [/variable]
            [or]
                # in case that the humans are killed by someone else, fallback speaker is Grog. E_H
                [variable]
                    name=second_unit.side
                    not_equals=1
                [/variable]
            [/or]
            [then]
                [message]
                    speaker=Grog
                    message= _ "Grog smash stupid Humans."
                [/message]
            [/then]
            [else]
                [message]
                    speaker=second_unit
                    message= _"Praise Eloh, I thought we were dead for sure."
                [/message]

                [message]
                    speaker=Grog
                    message= _"We go now."
                [/message]
            [/else]
        [/if]

        # and the operation "mudpie in a bottle" starts here! E_H.
        [set_variable]
            name=bottle_created
            value=yes
        [/set_variable]
        [set_variable]
            name=bottle_x
            value=$x1
        [/set_variable]
        [set_variable]
            name=bottle_y
            value=$y1
        [/set_variable]

        [item]
            x=$x1
            y=$y1
            image=items/potion-grey.png
        [/item]

        [redraw]
        [/redraw]

        [if]
            [variable]
                name=second_unit.id
                equals=Grog
            [/variable]
            [or]
                [variable]
                    name=second_unit.side
                    not_equals=1
                [/variable]
            [/or]
            [then]
                [message]
                    speaker=Grog
                    message= _ "Grog find bottle. What in it?"
                [/message]
            [/then]
            [else]
                [message]
                    speaker=second_unit
                    message= _"What a strange bottle. I wonder what's inside?"
                [/message]
            [/else]
        [/if]
    [/event]

    [event]
        name=moveto
        [filter]
            side=1
            x,y=$bottle_x,$bottle_y
        [/filter]

        [filter_condition]
            [variable]
                name=bottle_created
                equals=yes
            [/variable]
        [/filter_condition]

        [remove_item]
            x=$x1
            y=$y1
        [/remove_item]

        [floating_text]
            x,y=$unit.x,$unit.y
            text= _ "<span foreground='white'>*slop*</span>"
        [/floating_text]

        # need a corkscrew? E_H.
        [if]
            [variable]
                name=unit.id
                equals=Grog
            [/variable]
            [then]
                [message]
                    speaker=Grog
                    message=_"Grog break it to see."
                    sound=squishy-strike.wav
                [/message]
            [/then]
            [else]
                [message]
                    speaker=unit
                    # wmllint: local spelling Ooops
                    message=_"Ooops... I dropped it..."
                    sound=squishy-strike.wav
                [/message]
            [/else]
        [/if]

        [unit]
            type=Giant Mudcrawler TSoG
            id=mudcrawler
            name=_"Bubble"
            side=1
            [modifications]
                {TRAIT_RESILIENT}
                {TRAIT_STRONG}
                {TRAIT_LOYAL}
            [/modifications]
            {IS_LOYAL}
            x=$x1
            y=$y1
        [/unit]

        [if]
            [variable]
                name=unit.id
                equals=Grog
            [/variable]
            [then]
                [message]
                    speaker=Grog
                    message=_"Grog see mudpie. Hello mudpie."
                [/message]

                [message]
                    speaker=mudcrawler
                    message= _ "Splorch!" # wmllint: no spellcheck
                [/message]

                [message]
                    speaker=Grog
                    message=_"Grog ask mudpie to be Grog's friend?"
                [/message]
            [/then]
            [else]
                [message]
                    speaker=unit
                    message=_"Oh... Ugh... A magical pile of sludge... lovely..."
                [/message]

                [message]
                    speaker=mudcrawler
                    message= _ "Splorch!" # wmllint: no spellcheck
                [/message]

                [if]
                    [have_unit]
                        id=Arcamenel
                    [/have_unit]
                    [then]
                        [message]
                            speaker=Arcamenel
                            message=_"We should take it with us, the sun might dry it up!"
                        [/message]
                    [/then]
                    [else]
                        [message]
                            speaker=unit
                            message=_"We should take it with us, the sun might dry it up!"
                        [/message]
                    [/else]
                [/if]
            [/else]
        [/if]

        [message]
            speaker=mudcrawler
            message= _ "Mrrrmm! Gurgle!" # wmllint: no spellcheck
        [/message]
    [/event]
    #
    # Temple
    #
    [event]
        name=moveto

        [filter]
            side=1
            [filter_location]
                x,y=30,4
                radius=7
            [/filter_location]
        [/filter]

        [if]
            [variable]
                name=unit.id
                equals=Grog
            [/variable]
            [then]
                [message]
                    speaker=Grog
                    message=_"Temple look bad to Grog..."
                [/message]
            [/then]
            [else]
                [if] # I think that in situations like this, WML could really benefit of an [elseif] tag... E_H.
                    [variable]
                        name=unit.id
                        equals=ship
                    [/variable]
                    [then]
                        [message]
                            speaker=ship
                            caption= _ "Grog"
                            message= _ "Temple look bad to Grog..."
                            image=portraits/grog.png
                        [/message]
                    [/then]
                    [else]
                        [message]
                            speaker=unit
                            message=_"That temple is cursed, they say evil things dwell inside..."
                        [/message]
                    [/else]
                [/if]
            [/else]
        [/if]

        [set_variable]
            name=swamp_doubt_id
            value=$unit.id
        [/set_variable]
    [/event]

    # Again, other two nested events putted out of thier main event tag. E_H.
    [event]
        name=moveto

        [filter]
            side=1
            x=28,27,27,27,26,28,29,30,30,30,30,31,31,31
            y=2 ,3 ,4 ,5 ,3 ,5 ,4 ,2 ,3 ,4 ,5 ,3 ,4 ,5
        [/filter]

        [filter_condition]
            [variable]
                name=temple_visited
                equals=no
            [/variable]
        [/filter_condition]

        #do not dare replace this with a cuttle fish. I am BORED of cuttle fish - Eros
        # Acknowledged, the corpses are swimming now, as you asked. E_H.
        [unit]
            side=3
#ifdef HARD
            type=Soulless
#else
            type=Walking Corpse
#endif
            x,y=28,2
            variation=swimmer
        [/unit]
        [unit]
            side=3
#ifdef HARD
            type=Soulless
#else
            type=Walking Corpse
#endif
            x,y=27,5
            variation=swimmer
        [/unit]
        [unit]
            side=3
#ifdef EASY
            type=Walking Corpse
#else
            type=Soulless
#endif
            x,y=31,5
            variation=swimmer
        [/unit]

        [if]
            [variable]
                name=swamp_doubt_id
                equals=Grog
            [/variable]
            [or]
                [variable]
                    name=swamp_doubt_id
                    equals=ship
                [/variable]
            [/or]
            [then]
                [message]
                    speaker=Grog
                    message=_"Ugh! Grog see rotting dead snakes."
                [/message]
            [/then]
            [else]
                [message]
                    speaker=$swamp_doubt_id
                    message=_"Ugh! They have spread to the outlying swamps; foul rotting Nagas!"
                [/message]
            [/else]
        [/if]
    [/event]

    [event]
        name=moveto

        [filter]
            side=1
            x,y=30,4
        [/filter]

        [if]
            [have_unit]
                type=Walking Corpse, Soulless
            [/have_unit]

            [then]
                [message]
                    speaker=narrator
                    message=_"This temple was looted by nagas long ago."
                    image=wesnoth-icon.png
                [/message]
            [/then]

            [else]
                [message]
                    speaker=narrator
                    message=_"This temple was looted by nagas long ago. This hasn't stopped a colony of bats taking up residence here though."
                    image=wesnoth-icon.png
                [/message]

#ifndef EASY
                {GENERIC_UNIT 3 (Blood Bat) 30 4}
#else
                {GENERIC_UNIT 3 (Vampire Bat) 30 4}
#endif
#ifdef HARD
                {GENERIC_UNIT 3 (Blood Bat) 30 4}
#else
                {GENERIC_UNIT 3 (Vampire Bat) 30 4}
#endif
            [/else]
        [/if]

        {VARIABLE temple_visited yes}
    [/event]

    #
    # Ship sunk
    #
    [event]
        name=die

        [filter]
            id=ship
        [/filter]

        [filter_condition]
            [variable]
                name=ship_unloaded
                equals=no
            [/variable]
        [/filter_condition]

        [message]
            speaker=narrator
            message=_"Dumped in the freezing water Grog and the elves had no chance of survival. Their mission had failed."
            image=wesnoth-icon.png
        [/message]
    [/event]

    #
    # Death of naga leader
    #
    [event]
        name=die

        [filter]
            id=nagaboss
        [/filter]

        [if]
            [variable]
                name=second_unit.id
                equals=Grog
            [/variable]
            [then]
                [message]
                    speaker=Grog
                    message=_"Grog smash stinky snake."
                [/message]
            [/then]
            [else]
                [if]
                    [variable]
                        name=second_unit.race
                        equals=merman
                    [/variable]
                    [then]
                        [message]
                            speaker=second_unit
                            message= _"That will teach you to challenge the might of the Mermen!"
                        [/message]
                    [/then]
                    [else]
                        [if]
                            [variable]
                                name=second_unit.race
                                equals=elf
                            [/variable]
                            [then]
                                [message]
                                    speaker=second_unit
                                    message= _"Taste cold steel you filthy sea snake!"
                                [/message]
                            [/then]
                        [/if]
                    [/else]
                [/if]
            [/else]
        [/if]

        [if]
            [variable]
                name=temple_visited
                equals=no
            [/variable]

            [then]
                {LOOT 50 1}
            [/then]

            [else]
                {LOOT 100 1}

                [if]
                    [variable]
                        name=second_unit.id
                        equals=Grog
                    [/variable]
                    [then]
                        [message]
                            speaker=Grog
                            message=_"Grog says we found gold that was in the temple."
                        [/message]
                    [/then]
                    [else]
                        [message]
                            speaker=second_unit
                            message= _"Looks like we found out what happened to the gold in the temple anyway."
                        [/message]
                    [/else]
                [/if]
            [/else]
        [/if]
    [/event]

    [event]
        name=moveto
        [filter]
            id=Grog
            [filter_location]
                x,y=18,27
            [/filter_location]
        [/filter]

        [message]
            speaker=Grog
            message= _"Grog home this way."
        [/message]

        [message]
            speaker=Esanoo
            message= _"This is where we part ways Grog. I hope we meet again soon. Good luck!"
        [/message]

        #storing Esanoo for the C part. E_H.
        [store_unit]
            variable=stored_Esanoo
            [filter]
                id=Esanoo
            [/filter]
            kill=yes
            animate=no
        [/store_unit]

        [kill]
            race=merman
        [/kill]

        #yes, we must destroy that beautiful ship, otherwise we'll have it in recall list for next scenario... E_H.
        [kill]
            id=ship
        [/kill]

        [endlevel]
            bonus=yes
            result=victory
            {NEW_GOLD_CARRYOVER 40}
        [/endlevel]
    [/event]

    [event]
        name=victory

        {CLEAR_VARIABLE beach_landing}
        {CLEAR_VARIABLE pier_landing}
        {CLEAR_VARIABLE ship_unloaded}
        {CLEAR_VARIABLE swamp_doubt_id}
        {CLEAR_VARIABLE temple_visited}
        {CLEAR_VARIABLE bottle_created}
        {CLEAR_VARIABLE bottle_x}
        {CLEAR_VARIABLE bottle_y}
    [/event]

    #Esanoo death
    [event]
        name=last breath
        [filter]
            id=Esanoo
        [/filter]

        [message]
            speaker=unit
            message= _ "Farewell Grog, I go to the sea god."
        [/message]

        [endlevel]
            result=defeat
        [/endlevel]
    [/event]

    {~add-ons/The_Sojournings_of_Grog/utils/tsog-deaths.cfg}
[/scenario]
