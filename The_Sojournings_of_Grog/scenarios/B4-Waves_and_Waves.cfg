#textdomain wesnoth-The_Sojournings_of_Grog

# This scenario has been heavily modified.
#
# DO NOT MODIFY unless you FULLY understand the code.
# everything done here is DELIBERATE.
#
# The status of events in this scenario is recorded in humans_status = 1,2,3.
# If Ormron is alive you start in status 1 otherwise in status 2
# Status 1 is for when Ormron is alive (Exactly the same as the old B4).
# You have to move Ormron (and only Ormron) to the signpost in the middle of the
# island. Status 2 is for when Ormron is dead but the humans are not aggressive.
# You have to bypass the island and move Grog to a sign post in the North.
# Status 3 is for when the humans are actively aggressive (You can't start of like this).
# If you are on status 2 or 3 you end up skipping scenarios S3 and B and go directly
# on to B6. You can go from 1 or 2 to 3 if anyone other than Ormron enters the island.
# (The humans don't trust you yet) you can go from 1 to 2 (provisionally) if Ormron is
# killed. You can go from status 1 to 2 if Ormron dies however it would work just as
# well if he couldnt. Currently you cant attacks the humans but
# it would also work just as well if you could and they got angry if you did!
# Also if you are on status 2 or 3 currently you cant let a leader die though you could
# as you wont be playing B5. If you are on status 2 or 3 a messenger is sent when
# you reach the north bank.

#Please note that it is no longer possible to move to status 3, if you trespass human land you lose. Elvish_Hunter

# wmllint: recognize Grog
# wmllint: recognize Ormron

[scenario]
    name=_"Waves and Waves"

    id=B4
    next_scenario=S3
    {TURNS 20 18 16}

    {TWO_SUNS_DEFAULT_SCHEDULE}

    map_data="{~add-ons/The_Sojournings_of_Grog/maps/B4-Waves_and_Waves.map}"

    {INTRO_AND_SCENARIO_MUSIC "frantic.ogg" "traveling_minstrels.ogg"}
    {EXTRA_SCENARIO_MUSIC "battle.ogg"}
    {EXTRA_SCENARIO_MUSIC "casualties_of_war.ogg"}
    {EXTRA_SCENARIO_MUSIC "the_king_is_dead.ogg"}

    [story]
        [if]
            [have_unit]
                id=Ormron
                search_recall_list=yes
            [/have_unit]
            [then]
                [part]
                    story= _"They left the battlefield quickly, eager not to linger and advertise their presence as they still feared a hidden pursuit. At last Ormron led them to a large town that clearly retained some of its former majesty, but also had a distinct derelict look. Elyssa's fears about pursuit were proved justified."
                    background=story/Fortress2.jpg
                [/part]
            [/then]
            [else]
                [part]
                    story= _"They left the battlefield quickly, eager not to linger and advertise their presence as they still feared a hidden pursuit. At last Elyssa led them to a large town that clearly retained some of its former majesty, but also had a distinct derelict look. Elyssa's fears about pursuit were proved justified."
                    background=story/Fortress2.jpg
                [/part]
            [/else]
        [/if]
    [/story]

    [side]
        side=1
        controller=human
        team_name=goodies
        user_team_name= _ "Goodies"

        {GROG}
        type="Grog Great"

        recruit=Troll Whelp

        {GOLD 200 175 150}
        {INCOME 0 0 0}

        {TROLL_FLAG}
    [/side]

    [side]
        type=Orcish Warlord
        id=orcboss1
        name=_"Bragdish"

        profile=portraits/orcs/transparent/warlord.png

        canrecruit=yes
        # replace warrior with warlord for medium and hard. E_H.
        recruit=Orcish Crossbowman,Orcish Warrior,Goblin Knight,Goblin Pillager,Orcish Slayer
        #recruitment_pattern=scout,fighter,fighter,archer,archer,mixed fighter,mixed fighter
        side=2
        team_name=baddies
        user_team_name=_"Baddies"
        shroud=no

        {INCOME 20 25 30}
        {GOLD 300 350 400}

        [ai]
            [target]
                side=1
                value=4
            [/target]
        [/ai]

        {FLAG_VARIANT northerner}
    [/side]

    [side]
        type=General
        id=humanboss1
        name=_"Hannibal"

        canrecruit=yes
        # we mix up the recruit lists a little
        # No mages is intentional this is semi-because we want elyssa
        # to be the only mage and also drakes like fire. (Eros)
        recruit=Horseman,Dragoon,Poacher_Peasant,Longbowman,Spearman TSoG,Shock Trooper,Thug_Peasant,Rogue,Fencer

        side=3
        team_name=goodies
        user_team_name=_"Goodies"
        shroud=no

        {INCOME 6 4 2}
        {GOLD 120 100 80}

        #we use these to store the human armies
        save_id=humanboss1

        [ai]
            # get an even coverge of units
            recruitment_pattern=scout,fighter,fighter,archer
            #try and get all round recruitment
            recruitment_ignore_bad_combat=yes
            recruitment_ignore_bad_movement=yes
        [/ai]

        {FLAG_VARIANT loyalist}
    [/side]

    [side]
        type=Orcish Warlord
        id=orcboss2
        name=_"Vishnak"

        profile=portraits/orcs/transparent/grunt-2.png

        canrecruit=yes

        # replace Goblin Knight with Direwolf Rider for Medium and Hard. E_H.
        recruit=Orcish Crossbowman,Orcish Warrior,Goblin Knight,Orcish Slayer
        #recruitment_pattern=scout,fighter,fighter,archer,archer,mixed fighter,scout
        side=4
        team_name=baddies
        user_team_name=_"Baddies"
        shroud=no

        {INCOME 20 25 30}
        {GOLD 300 350 400}

        [ai]
            [target]
                side=1
                value=4
            [/target]
        [/ai]

        {FLAG_VARIANT northerner}
    [/side]

    [side]
        type=Highwayman_Peasant
        id=humanboss2
        name=_"Hamilcar"

        canrecruit=yes
        #we mix up the recruit lists a little
        recruit=Cavalryman,Outlaw_Peasant,Poacher_Peasant,Bowman,Swordsman TSoG,Heavy Infantryman,Bandit_Peasant,Thief,Fencer
        side=5
        team_name=goodies
        user_team_name=_"Goodies"
        shroud=no

        {INCOME 6 4 2}
        {GOLD 120 100 80}

        save_id=humanboss2

        [ai]
            #try and get all round recruitment
            recruitment_pattern=scout,fighter,fighter,archer,mixed fighter
            recruitment_ignore_bad_combat=yes
            recruitment_ignore_bad_movement=yes
        [/ai]

        {FLAG_VARIANT loyalist}
    [/side]

    [side]
        type=Drake Flameheart
        id=drakeboss1
        name=_"Kran Kor"

        canrecruit=yes

        recruit=Drake Warrior,Drake Thrasher,Drake Arbiter,Fire Drake,Drake Flare,Sky Drake
        [ai]
            #recruits more fighters to give variation
            recruitment_pattern=scout,fighter,fighter,fighter,archer,mixed fighter,mixed fighter
        [/ai]
        side=6
        team_name=baddies
        user_team_name=_"Baddies"
        shroud=no

        {INCOME 20 25 30}
        {GOLD 300 350 400}

        {FLAG_VARIANT drake}
    [/side]

    [side]
        type=Ranger_Peasant
        id=humanboss3
        name=_"Hazdrubal"

        canrecruit=yes
        #we mix up the recruit lists a little
        recruit=Knight,Lancer,Footpad_Peasant,Trapper_Peasant,Bowman,Pikeman,Heavy Infantryman,Thug_Peasant,Thief,Duelist
        side=7
        team_name=goodies
        user_team_name=_"Goodies"
        shroud=no

        {INCOME 6 4 2}
        {GOLD 120 100 80}

        save_id=humanboss3

        [ai]
            #try and get all round recruitment
            recruitment_pattern=scout,fighter,fighter,archer,mixed fighter
            recruitment_ignore_bad_combat=yes
            recruitment_ignore_bad_movement=yes
        [/ai]

        {FLAG_VARIANT loyalist}
    [/side]

    [side]
        type=Inferno Drake
        id=drakeboss2
        name=_"Marhildian"

        canrecruit=yes

        recruit=Drake Warrior,Drake Thrasher,Drake Arbiter,Fire Drake,Drake Flare,Sky Drake
        [ai]
            #recruits more archers to give variation
            recruitment_pattern=scout,fighter,archer,archer,archer,mixed fighter,mixed fighter
        [/ai]
        side=8
        team_name=baddies
        user_team_name=_"Baddies"
        shroud=no

        {INCOME 20 25 30}
        {GOLD 300 350 400}

        {FLAG_VARIANT drake}
    [/side]

    {OBJ_GALE_WHIP 50 12}
    [item]
        image=scenery/temple1.png
        x,y=50,12
    [/item]

    #whip_taken is called by macro OBJ_GALE_WHIP. Elvish_Hunter
    [event]
        name=whip_taken
        [role]
            type=Highwayman_Peasant,General,Grand Marshal,Ranger_Peasant
            role=anotherboss
        [/role]
        [message]
            role=anotherboss
            message= _ "No! Our sacred whip! I'm gonna kill you!"
        [/message]
    [/event]

    [event]
        name=prestart

        #blue is humans flag
        {PLACE_IMAGE "units/transport/transport-galleon.png~RC(magenta>blue)" 28 10}
        {PLACE_IMAGE "units/transport/galleon.png~RC(magenta>blue)" 44 15}
        {PLACE_IMAGE "units/transport/galleon.png~RC(magenta>blue)" 46 14}
        {PLACE_IMAGE "units/transport/transport-galleon.png~RC(magenta>blue)" 44 13}
        {PLACE_IMAGE "units/transport/galleon.png~RC(magenta>blue)" 44 11}

        # placing also the temple label, as shadowblack suggested. E_H.
        [label]
            text= _ "Human Temple"
            x=50
            y=12
        [/label]

        # on Easy, keep the third hex of each castle, as shadowblack suggested. On Medium and Hard, remove. E_H.
#ifndef EASY
        [terrain]
            x,y=33,16
            terrain=Rr
        [/terrain]
        [terrain]
            x,y=33,11
            terrain=Re^Gvs
        [/terrain]
        [terrain]
            x,y=42,15
            terrain=Re^Gvs
        [/terrain]
#endif

        #setting the whip variable.
        {VARIABLE whip_taken no}
    [/event]

#define OBJECTIVES_STATUS_1
    [objectives]
        side=1
        [objective]
            description= _ "Ormron must reach the signpost in the middle of the village."
            condition=win
        [/objective]
        [objective]
            description= _ "Any of your units except Ormron trespass on human's land."
            condition=lose
        [/objective]
        [objective]
            description= _ "Death of Grog"
            condition=lose
        [/objective]
        [objective]
            description= _ "Death of Zurg"
            condition=lose
        [/objective]
        [objective]
            description= _ "Death of Elyssa"
            condition=lose
        [/objective]
        #	[objective]
        #		description= _ "Death of Ormron"
        #		condition=lose
        #	[/objective]
        [objective]
            description= _ "Death of any human leader."
            condition=lose
        [/objective]
        [objective]
            description= _ "Time runs out"
            condition=lose
        [/objective]
        [gold_carryover]
            bonus=yes
            carryover_percentage=40
        [/gold_carryover]
    [/objectives]
#enddef

#define OBJECTIVES_STATUS_2
    [objectives]
        side=1
        [objective]
            description= _ "Grog must reach the signpost to the north of the village."
            condition=win
        [/objective]
        [objective]
            description= _ "Any of your units trespass on human's land."
            condition=lose
        [/objective]
        [objective]
            description= _ "Death of Grog"
            condition=lose
        [/objective]
        [objective]
            description= _ "Death of Zurg"
            condition=lose
        [/objective]
        [objective]
            description= _ "Death of Elyssa"
            condition=lose
        [/objective]
        [objective]
            description= _ "Death of any human leader."
            condition=lose
        [/objective]
        [objective]
            description= _ "Time runs out"
            condition=lose
        [/objective]
        [gold_carryover]
            bonus=yes
            carryover_percentage=40
        [/gold_carryover]
    [/objectives]
#enddef

    #
    # Start: sort out enemy leader names, sort out variables, recall units,
    # sort out human_status, and talk+objectives
    #
    [event]
        name=start

        {RENAME_IF_DEAD isalive_orcboss1 orcboss1 (_"Grugdush")}
        {RENAME_IF_DEAD isalive_orcboss2 orcboss2 (_"Grarbag")}

        {VARIABLE messenger_sent no}

        [recall]
            id=Elyssa
        [/recall]

        [recall]
            id=Zurg
        [/recall]

        [recall]
            id=ogreboss
        [/recall]

        [recall]
            id=gryphonboss
        [/recall]

        [recall]
            id=Ormron
        [/recall]

        #[recall]
        #	id=mudcrawler
        #[/recall]

        #[recall]
        #	id=Krunk
        #[/recall]

        {RECALL_SPOKESMAN}

        {RECALL_SIDEKICK}

        [if]
            [have_unit]
                id=Ormron
            [/have_unit]

            #STATUS 1
            [then]
                #the humans are friendly
                {VARIABLE humans_status 1}
            [/then]

            #STATUS 2
            [else]
                #the humans are not friendly
                {VARIABLE humans_status 2}
                #and, to allow the playe winning, we give less gold to the Drakes. E_H.
                [modify_side]
                    side=6
#ifdef EASY
                    gold=150
                    income=10
#endif
#ifdef NORMAL
                    gold=175
                    income=12
#endif
#ifdef HARD
                    gold=200
                    income=15
#endif
                [/modify_side]
                [modify_side]
                    side=8
#ifdef EASY
                    gold=150
                    income=10
#endif
#ifdef NORMAL
                    gold=175
                    income=12
#endif
#ifdef HARD
                    gold=200
                    income=15
#endif
                [/modify_side]
            [/else]
        [/if]

        #three different conversations, objectives etc
        #1 is for Ormron alive
        #2 is for humans spokesman
        #3 is for neither
        [if]
            [variable]
                name=humans_status
                equals=1
            [/variable]

            #STATUS 1
            [then]
                [message]
                    speaker=Ormron
                    message= _ "This is our home, our last refuge. We are ruled by a council of elders; a seat on which is a highly prestigious position, or at least it was until recently. The elders also lead our armies into combat, something we see more of these days than anything else. New friends will be most welcome, but morale is slowly ebbing away due to Drakes burning our crops, Nagas poisoning our waters and Saurians plundering our villages."
                [/message]

                [message]
                    speaker=Ormron
                    message= _ "We can beat them time after time, but then they retreat into the mountain fortresses, and there they are safe from any counter attack. Were we ever to lose a battle then the cause would be lost. Alas, every battle we win costs us good men and valuable land, until now, at last, they rampage against the very walls of the citadel."
                [/message]

                [message]
                    speaker=Grog
                    message= _ "Humans help Trolls. Trolls help Humans. Trolls kill hissing flying things. Den Trolls make home in mountain."
                [/message]

                [message]
                    speaker=Elyssa
                    message= _ "Sounds like a good plan to me; then we can help protect each other. We will need to convince the elders that we can help and are trustworthy."
                [/message]

                [message]
                    speaker=Grog
                    message= _ "Grog talk to Humans."
                [/message]

                [message]
                    speaker=Ormron
                    message= _ "Perhaps I should meet with the elders first and explain the whole situation."
                [/message]

                [message]
                    speaker=Elyssa
                    message= _ "The <i>whole</i> situation?"
                [/message]

                [message]
                    speaker=Ormron
                    message= _ "Well, the council may see this situation a little differently; we have brought an army of rampaging Orcs with us after all! They may be less likely to view you as heroes for destroying the Lich and more likely to see you as... warmongers; plus you are... well... Trolls..."
                [/message]

                [message]
                    speaker=Grog
                    message= _ "Human not clever. Troll be friend den Human think Troll is enemy?"
                [/message]

                [message]
                    speaker=Ormron
                    message= _ "Well..."
                [/message]

                [message]
                    speaker=Elyssa
                    message= _ "OK! It's OK Grog, they will understand perfectly once Ormron has explained everything. We shall wait here while he meets with the council. Right Grog?"
                [/message]

                [message]
                    speaker=Grog
                    message= _ "Grog wait here. Humans talk about smash. Trolls just smash."
                [/message]

                [message]
                    speaker=Ormron
                    message= _ "Yes... Well, do not cross onto the island until I have returned. The guards may be rather hostile."
                [/message]

                [message]
                    speaker=orcboss1
                    message= _ "You will never make it across the water, stinking mage! We Orcs never give up."
                [/message]

                [message]
                    speaker=drakeboss1
                    # wmllint: local spelling Burrrrn!
                    message= _ "Burrrrn! Burn it down! Fledgling murderers. Kill them all!"
                [/message]

                {HIGHLIGHT_IMAGE 36 14 "scenery/signpost.png" ()}

                {OBJECTIVES_STATUS_1}
            [/then]
        [/if]

        #STATUS 2 Human Prisoners alive
        [if]
            [variable]
                name=humans_status
                equals=2
            [/variable]

            [and]
                [variable]
                    name=human_prisoners_helpful
                    equals=yes
                [/variable]
            [/and]

            [then]
                [message]
                    speaker=spokesman
                    message= _ "This is our home, our last refuge. We are ruled by a council of elders; a seat on which is a highly prestigious position, or at least it was until recently. The elders also lead our armies into combat, something we see more of these days than anything else. New friends will be most welcome, but morale is slowly ebbing away due to Drakes burning our crops, Nagas poisoning our waters and Saurians plundering our villages."
                [/message]

                [message]
                    speaker=spokesman
                    message= _ "We can beat them time after time, but then they retreat into the mountain fortresses, and there they are safe from any counter attack. Were we ever to lose a battle then the cause would be lost. Alas, every battle we win costs us good men and valuable land, until now, at last, they rampage against the very walls of the citadel."
                [/message]

                [message]
                    speaker=Grog
                    message= _ "Humans help Trolls. Trolls help Humans. Trolls kill hissing flying things. Den Trolls make home in mountain."
                [/message]

                [message]
                    speaker=Elyssa
                    message= _ "Yes I agree. I have heard often of these men. They have a name for being good and brave, but, I imagine, are little like to help us unless we have something to offer."
                [/message]

                [message]
                    speaker=Zurg
                    message= _ "Which we don't."
                [/message]

                [message]
                    speaker=Elyssa
                    message= _ "I still think that they are likely to view us more as friends rather than enemies to the orcs."
                [/message]

                [message]
                    speaker=Grog
                    message= _ "Grog talk to Humans."
                [/message]

                [message]
                    speaker=humanboss1
                    message= _ "Stay of our land whether ye be orc, drake, or troll."
                [/message]

                [message]
                    speaker=spokesman
                    message= _ "Hey, over there."
                [/message]

                [message]
                    speaker=humanboss1
                    message= _ "Ah, you have returned."
                [/message]

                [message]
                    speaker=humanboss2
                    message= _ "Where is Ormron your leader?"
                [/message]

                [message]
                    speaker=sidekick
                    message= _ "He died in the fighting."
                [/message]

                [message]
                    speaker=humanboss3
                    message= _ "How many of your men have you brought back with you."
                [/message]

                #TODO: use a macro to count them here

                [message]
                    speaker=spokesman
                    #po: a score is twenty (Eros)
                    message= _ "Half a score."
                [/message]

                [message]
                    speaker=humanboss1
                    message= _ "HALF A SCORE! Of all the men we sent out. You have lost your leader and your party is decimated and you bring us an Orcish army on your tail and you want us to believe that these trolls want to help us!? They help us, kill us more like."
                [/message]

                [message]
                    speaker=sidekick
                    message= _ "They saved our lives."
                [/message]

                [message]
                    speaker=humanboss2
                    message= _ "Well now its time for you to save theirs. You may come across if you can dare hold your heads high for the shame."
                [/message]

                [message]
                    speaker=spokesman
                    message= _ "No thanks, I think we will stay here."
                [/message]

                [message]
                    speaker=humanboss3
                    message= _ "Very well then, you are for with banished from this land until you can return in honor."
                [/message]

                [message]
                    speaker=Zurg
                    message= _ "We have to bypass stupid humans."
                [/message]

                [message]
                    speaker=Elyssa
                    message= _ "If so we will have to go north. South and east of is the great desert."
                [/message]

                [message]
                    speaker=Grog
                    message= _ "Grog thinks humans better alive than dead. Them stop orc cross river after us."
                [/message]

                [message]
                    speaker=Elyssa
                    message= _ "As long as we keep off of their land I imagine that they will leave us alone."
                [/message]

                {HIGHLIGHT_IMAGE 34 1 "scenery/signpost.png" ()}

                {OBJECTIVES_STATUS_2}
            [/then]
        [/if]

        #STATUS 2 Human Prisoners not alive
        [if]
            [variable]
                name=humans_status
                equals=2
            [/variable]

            [and]
                [variable]
                    name=human_prisoners_helpful
                    equals=no
                [/variable]
            [/and]

            [then]
                [message]
                    speaker=Elyssa
                    message= _ "Yes I agree. I have heard often of these men. They have a name for being good and brave, but, I imagine, are little like to help us unless we have something to offer."
                [/message]

                [message]
                    speaker=Zurg
                    message= _ "Which we don't."
                [/message]

                [message]
                    speaker=Grog
                    message= _ "Humans help Trolls. Trolls help Humans. Trolls kill hissing flying things. Den Trolls make home in mountain."
                [/message]

                [message]
                    speaker=Elyssa
                    message= _ "I still think that they are likely to view us more as friends rather than enemies to the orcs."
                [/message]

                [message]
                    speaker=Grog
                    message= _ "Grog talk to Humans."
                [/message]

                [message]
                    speaker=humanboss1
                    message= _ "Stay of our land whether ye be orc, drake, or troll."
                [/message]

                [message]
                    speaker=Zurg
                    message= _ "It looks like we get no succor here. We will have to bypass them."
                [/message]

                [message]
                    speaker=Elyssa
                    message= _ "If so we will have to go north. South and east of is the great desert."
                [/message]

                [message]
                    speaker=Grog
                    message= _ "Grog thinks humans better alive than dead. Them stop orc cross river after us."
                [/message]

                [message]
                    speaker=Elyssa
                    message= _ "As long as we keep off of their land I imagine that they will leave us alone."
                [/message]

                {HIGHLIGHT_IMAGE 34 1 "scenery/signpost.png" ()}

                {OBJECTIVES_STATUS_2}
            [/then]
        [/if]
    [/event]

    #
    # Near Human Land: remind player to stay off of their land
    # fires if status=2,3
    #
    [event]
        name=moveto
        first_time_only=yes

        [filter]
            side=1
            [filter_location]
                x=18,18,32,38,40,34
                y=13,10,18,18,10,9
                radius=3,3,4,5,4,3
            [/filter_location]

            [not]
                id=Ormron
            [/not]
        [/filter]

        [role]
            type=Ranger_Peasant,Highwayman_Peasant,General,Grand Marshal
            role=aboss
        [/role]

        [if]
            [variable]
                name=humans_status
                equals=1
            [/variable]

            #STATUS 1
            [then]
                [message]
                    role=aboss
                    message= _ "I am warning you. Stay off our land"
                [/message]
            [/then]

            #STATUS 2
            [else]
                [message]
                    role=aboss
                    message= _ "I am warning you. Stay off our land whoever you are."
                [/message]
            [/else]
        [/if]
    [/event]

    #
    # Enter Human Land: Makes them angry and start fighting you
    # fires if status=2,3
    #
    [event]
        name=moveto
        first_time_only=yes

        [filter]
            side=1
            [filter_location]
                x=29   ,30   ,31   ,32   ,33   ,34  ,35   ,36   ,37   ,38   ,39   ,40   ,41   ,42   ,43   ,50
                y=12-15,11-15,11-16,10-17,10-18,9-17,10-18,10-17,11-18,10-17,11-17,10-16,11-17,11-16,12-16,12
            [/filter_location]

            [not]
                id=Ormron
            [/not]
        [/filter]

        [role]
            type=Highwayman_Peasant,General,Grand Marshal,Ranger_Peasant
            role=aboss
        [/role]

        [message]
            role=aboss
            message= _ "First they want our assistance and then they invade our land. Kill them all."
        [/message]

        #We have to explain the objectives change here if you were moving Ormron to the village hall
        [if]
            [variable]
                name=humans_status
                equals=1
            [/variable]

            #STATUS 1
            [then]
                [message]
                    speaker=Elyssa
                    message= _ "Now you've done it. Plan B. Now what is Plan B?"
                [/message]

                [message]
                    speaker=Grog
                    message= _ "We need human help us against dragon. Grog say no hope now."
                [/message]
            [/then]

            [else]
                [message]
                    speaker=Elyssa
                    message= _ "Now you've done it."
                [/message]
                [message]
                    speaker=Grog
                    message= _ "We need human help us against dragon. Grog say no hope now."
                [/message]
            [/else]
        [/if]

        [endlevel]
            result=defeat
        [/endlevel]
    [/event]

    #
    # Reach North Bank: Humans send a messenger
    # fires if status=2,3
    # TODO: if you make them angry (rather than annoyed) after the messenger is sent
    # send another one
    #
    [event]
        name=moveto
        first_time_only=no

        [filter]
            side=1
            [filter_location]
                x=1-63
                y=1-8
            [/filter_location]
        [/filter]

        [if]
            [variable]
                name=messenger_sent
                equals=no
            [/variable]

            [then]
                [if]
                    [variable]
                        name=humans_status
                        not_equals=1
                    [/variable]

                    #STATUS 2, 3
                    [then]
                        [role]
                            type=General,Grand Marshal,Ranger_Peasant,Highwayman_Peasant
                            role=aboss
                        [/role]

                        #STATUS 2
                        [message]
                            role=aboss
                            message= _ "They have reached the north bank. Send a messenger to advise the northern garrison of the situation."
                        [/message]

                        {VARIABLE messenger_sent yes}

                        [unit]
                            x,y=36,13
                            type=Cavalier
                            id=human_messenger
                            side=3
                            random_traits=yes
                            generate_name=yes
                        [/unit]

                        [message]
                            speaker=human_messenger
                            message= _ "I go my Lords."
                        [/message]

                        [kill]
                            id=human_messenger
                            animate=no
                            fire_event=no
                        [/kill]

                        [sound]
                            name=horse-canter.wav
                        [/sound]

                        [move_unit_fake]
                            type=Cavalier
                            side=3
                            x=36,35,34,34,34,34,34,34,34,34,33,33,33,34,34
                            y=13,13,12,11,10,9 ,8 ,7 ,6 ,5 ,5 ,4 ,3 ,2 ,1
                        [/move_unit_fake]
                    [/then]
                [/if]
            [/then]

            [else]
                [allow_undo]
                [/allow_undo]
            [/else]
        [/if]
    [/event]

    #
    # We have to include this here so that Ormron's
    # deaths fire in the right order
    #
    {~add-ons/The_Sojournings_of_Grog/utils/tsog-deaths.cfg}

    #
    # Ormron Death: talk and change around statuses
    #
    [event]
        name=die
        [filter]
            id=Ormron
        [/filter]

        [if]
            [variable]
                name=humans_status
                equals=1
            [/variable]

            #STATUS 1
            [then]
                #the humans are no longer friendly..
                #..but arent angry yet either
                {VARIABLE humans_status 2}

                [message]
                    speaker=Elyssa
                    message= _ "How are we going to persuade the humans of our good intentions if he is dead."
                [/message]

                [message]
                    speaker=Zurg
                    message= _ "It looks like we get no succor here. We will have to bypass them."
                [/message]

                [message]
                    speaker=Elyssa
                    message= _ "If so we will have to go north. South and east of is the great desert."
                [/message]

                [message]
                    speaker=Grog
                    message= _ "Grog thinks humans better alive than dead. Them stop orc cross river after us."
                [/message]

                [message]
                    speaker=Elyssa
                    message= _ "As long as we keep off of their land I imagine that they will leave us alone."
                [/message]

                [role]
                    type=Ranger_Peasant,Highwayman_Peasant,General,Grand Marshal
                    role=aboss
                [/role]

                [message]
                    role=aboss
                    message= _ "I warn you. Don't step on our land."
                [/message]

                [remove_item]
                    x,y=36,14
                [/remove_item]

                {HIGHLIGHT_IMAGE 34 1 "scenery/signpost.png" ()}

                {OBJECTIVES_STATUS_2}
            [/then]
        [/if]
    [/event]

    #
    # Moveto Ormron Village: you win
    # fires if status=1
    #
    [event]
        name=moveto
        first_time_only=yes

        [filter]
            id=Ormron
            x,y=36,14
        [/filter]

        [if]
            [variable]
                name=humans_status
                equals=1
            [/variable]

            #STATUS 1
            [then]
                [hide_unit]
                    id=Ormron
                [/hide_unit]

                [message]
                    speaker=narrator
                    message= _ "Ormron stood before the council of elders, and told the tale of their capture by the Undead and their rescue by the Trolls, with whom they went on to finally eradicate the Lich. He fervently argued that the Trolls and their friends were the salvation they had long sought, and that their help should be welcomed."
                    image=wesnoth-icon.png
                [/message]

                [unhide_unit]
                    id=Ormron
                [/unhide_unit]

                [message]
                    speaker=Ormron
                    message=_"The council has decided that Grog and Elyssa should come before them to discuss the situation."
                [/message]

                [message]
                    speaker=Zurg
                    message=_"Zurg stay here and fight."
                [/message]

                [delay]
                    time=750
                [/delay]

                #move grog there

                [move_unit]
                    id=Grog
                    to_x,to_y=36,13
                [/move_unit]

                [delay]
                    time=500
                [/delay]

                #move Elyssa there
                [move_unit]
                    id=Elyssa
                    to_x,to_y=36,13
                [/move_unit]

                [delay]
                    time=500
                [/delay]

                [endlevel]
                    bonus=yes
                    result=victory
                    {NEW_GOLD_CARRYOVER 40}
                [/endlevel]
            [/then]
        [/if]
    [/event]

    #
    # Grog Moveto Signpost: you win
    # fires if status=2,3
    #
    [event]
        name=moveto
        first_time_only=yes

        [filter]
            id=Grog
            x,y=34,1
        [/filter]

        [if]
            [variable]
                name=humans_status
                not_equals=1
            [/variable]

            #STATUS 2,3
            [then]
                [message]
                    speaker=Grog
                    message=_"Grog say we go now."
                [/message]

                [endlevel]
                    #we skip the next two scenarios
                    next_scenario=B6
                    bonus=yes
                    result=victory
                    {NEW_GOLD_CARRYOVER 40}
                [/endlevel]
            [/then]
        [/if]
    [/event]

    #
    # Human Leader Death: talk and lose.
    # Fires always.
    #
    [event]
        name=last breath
        first_time_only=no

        [filter]
            id=humanboss1
        [/filter]
        [or]
            [filter]
                id=humanboss2
            [/filter]
        [/or]
        [or]
            [filter]
                id=humanboss3
            [/filter]
        [/or]

        [message]
            speaker=unit
            message= _ "I fall."
        [/message]

        [if]
            [variable]
                name=humans_status
                equals=1
            [/variable]
            [then]
                [message]
                    speaker=Grog
                    message= _ "We need human help us against dragon. Grog say no hope now."
                [/message]

                [endlevel]
                    result=defeat
                [/endlevel]
            [/then]

            [else]
                [message]
                    speaker=Zurg
                    message= _ "We needed them to hold our back."
                [/message]

                [endlevel]
                    result=defeat
                [/endlevel]
            [/else]
        [/if]
    [/event]

    #
    # Drake 1 Death: give bonuses to other enemies
    # Gives a bonus to the other enemy of same race
    # Bigger for the orcs as we dont want them being killed
    #
    [event]
        name=die

        [filter]
            id=drakeboss1
        [/filter]

        #keep this for renaming if dead
        {VARIABLE isalive_drakeboss1 no}

        [gold]
            side=8
            amount=80
        [/gold]
    [/event]

    #
    # Drake 2 Death: give bonuses to other enemies
    #
    [event]
        name=die

        [filter]
            id=drakeboss2
        [/filter]

        {VARIABLE isalive_drakeboss2 no}

        [gold]
            side=6
            amount=80
        [/gold]
    [/event]

    #
    # Orc 1 Death: give bonuses to other enemies
    #
    [event]
        name=die

        [filter]
            id=orcboss1
        [/filter]

        [gold]
            side=4
            amount=160
        [/gold]
    [/event]

    #
    # Orc 2 Death: give bonuses to other enemies
    #
    [event]
        name=die

        [filter]
            id=orcboss2
        [/filter]

        [gold]
            side=2
            amount=160
        [/gold]
    [/event]

    #
    # Time Over: you lose
    # Always fires
    #
    [event]
        name=time over

        [if]
            [variable]
                name=humans_status
                equals=1
            [/variable]

            #STATUS 1
            [then]
                [message]
                    speaker=Elyssa
                    message= _ "We have spent too long here. The crops will be ruined."
                [/message]
            [/then]

            #STATUS 2,3
            [else]
                [message]
                    speaker=Elyssa
                    message= _ "We have spent too long here. We cannot hope to be successful."
                [/message]
            [/else]
        [/if]
    [/event]

    #
    # Victory: clear up
    #
    [event]
        name=victory

        #storing Elyssa for Council of War cutscene. Elvish_Hunter
        [store_unit]
            variable=stored_Elyssa
            kill=no
            animate=no
            [filter]
                id=Elyssa
            [/filter]
        [/store_unit]

        {CLEAR_VARIABLE "messenger_sent"}

        [endlevel]
            bonus=yes
            result=victory
            {NEW_GOLD_CARRYOVER 40}
        [/endlevel]
    [/event]
[/scenario]
